const servicesTree = [
  {
    slug: 'consultation',
    title: 'Консультация',
    description: 'Подберём эксперта и сформируем стратегию проверки документов или подписи до запуска исследований.',
    details:
      'Мы проводим первичный анализ задачи, обозначаем подходящие методики и формируем требования к материалам, чтобы вы сразу понимали бюджет и сроки.',
    children: [
      {
        slug: 'case-audit',
        title: 'Аудит материалов дела',
        description: 'Проверим корректность собранных документов и оценим, какие исследования усилят позицию.',
        details:
          'Эксперт анализирует имеющуюся переписку, заключения и первичные документы, чтобы определить, какие доказательства стоит запросить дополнительно.',
        children: [],
      },
      {
        slug: 'expert-selection',
        title: 'Подбор эксперта',
        description: 'Рекомендуем профильного специалиста и формируем перечень вопросов для экспертизы.',
        details:
          'Помогаем выбрать исполнителя исследования, согласовать сроки и подготовить корректные формулировки заданий.',
        children: [],
      },
    ],
  },
  {
    slug: 'review',
    title: 'Рецензирование заключений',
    description: 'Анализируем сторонние экспертизы и выдаём заключение о корректности методик и выводов.',
    details:
      'Проверяем каждое утверждение в чужом исследовании, отмечаем нарушения ГОСТов и стандартов, а также даём рекомендации по повторному исследованию.',
    children: [],
  },
  {
    slug: 'handwriting',
    title: 'Почерковедческая экспертиза',
    description: 'Определяем подпись и почерк, выявляем подделку и оцениваем механизмы нанесения.',
    details:
      'Исследуем оригиналы и копии, применяем микроскопию и компьютерный анализ, чтобы доказать, кто именно поставил подпись.',
    children: [
      {
        slug: 'signature-identification',
        title: 'Идентификация подписи',
        description: 'Устанавливаем, кем выполнена подпись, и есть ли признаки подделки.',
        details:
          'Сравниваем спорную подпись с образцами, анализируем динамику движений и признаки исполнения под давлением или имитации.',
        children: [
          {
            slug: 'signature-inking',
            title: 'Исследование способа нанесения',
            description: 'Определяем, наносилась ли подпись в один приём, использовались ли технические средства.',
            details:
              'Применяем микроскопию и трасологический анализ, чтобы обнаружить следы остановок, двойных штрихов и иных признаков механической подделки.',
            children: [],
          },
        ],
      },
      {
        slug: 'handwriting-comparison',
        title: 'Сравнение рукописных текстов',
        description: 'Сопоставляем объёмные рукописные тексты и выделяем индивидуальные признаки автора.',
        details:
          'Проводим графологический анализ, выделяем устойчивые элементы почерка и формулируем вывод о вероятности авторства.',
        children: [],
      },
    ],
  },
  {
    slug: 'technical-docs',
    title: 'Техническая экспертиза документов',
    description: 'Исследуем бланки, печати, исправления, используем спектральный анализ материалов.',
    details:
      'Определяем нанесение печатей и штампов, выявляем подмены страниц, анализируем пигменты и химический состав чернил.',
    children: [
      {
        slug: 'seal-verification',
        title: 'Проверка печатей и штампов',
        description: 'Выявляем перерисованные или смонтированные оттиски.',
        details:
          'Сравниваем геометрию и фактуру, анализируем особенности клише и выявляем следы подделки оттисков.',
        children: [],
      },
      {
        slug: 'ink-analysis',
        title: 'Спектральный анализ чернил',
        description: 'Определяем, использовались ли разные чернила и когда наносился текст.',
        details:
          'Применяем спектральные и хроматографические методы, чтобы установить состав пасты и оценить давность нанесения.',
        children: [],
      },
    ],
  },
  {
    slug: 'dating',
    title: 'Экспертиза давности',
    description: 'Определяем примерный срок создания документа или подписи по химическим и физическим признакам.',
    details:
      'Комбинируем химический анализ и исследование бумаги, чтобы приблизительно определить дату создания документа.',
    children: [],
  },
  {
    slug: 'construction',
    title: 'Строительная экспертиза',
    description: 'Оцениваем конструктив, материалы и соответствие регламентам, выявляем нарушения при строительстве.',
    details:
      'Проводим инструментальные обследования, считаем сметы и проверяем соответствие СНиПов, чтобы подтвердить качество работ.',
    children: [
      {
        slug: 'cost-examination',
        title: 'Проверка смет и подрядчиков',
        description: 'Сопоставляем сметную документацию с фактическими объёмами работ.',
        details:
          'Анализируем акты, накладные и проектную документацию, рассчитываем экономически обоснованную стоимость.',
        children: [],
      },
    ],
  },
  {
    slug: 'linguistic',
    title: 'Лингвистическая экспертиза',
    description: 'Анализируем текстовые материалы, устанавливаем смысловые и авторские признаки, фиксируем искажения.',
    details:
      'Проводим семантический анализ, выделяем признаки авторства и оцениваем наличие экстремистских или дискредитирующих формулировок.',
    children: [],
  },
  {
    slug: 'it-forensics',
    title: 'Компьютерно-техническая экспертиза',
    description: 'Исследуем цифровые носители, определяем вмешательства, восстанавливаем последовательность событий.',
    details:
      'Анализируем жёсткие диски, мобильные устройства и логи, чтобы восстановить цепочку действий и выявить следы взлома.',
    children: [
      {
        slug: 'mobile-forensics',
        title: 'Мобильная экспертиза',
        description: 'Работаем с дампами смартфонов и мессенджерами, восстанавливаем удалённые данные.',
        details:
          'Используем UFED и собственные методики, чтобы извлечь переписку, медиа и геоданные даже после удаления.',
        children: [],
      },
      {
        slug: 'log-analysis',
        title: 'Анализ журналов событий',
        description: 'Фиксируем хронологию инцидента по логам серверов и рабочих станций.',
        details:
          'Коррелируем записи из разных систем, выделяем аномалии и восстанавливаем сценарий атаки.',
        children: [],
      },
    ],
  },
]

const serviceIndex = new Map()

const enrichTree = (nodes, parentSlug = null, level = 0, parentPath = '') =>
  nodes.map((node) => {
    const children = node.children ?? []
    const path = parentPath ? `${parentPath}/${node.slug}` : node.slug
    const enrichedChildren = enrichTree(children, node.slug, level + 1, path)
    const entry = {
      ...node,
      children: enrichedChildren,
      parentSlug,
      level,
      path,
    }
    serviceIndex.set(path, entry)
    return entry
  })

export const services = enrichTree(servicesTree)

export function findService(pathOrSegments) {
  if (!pathOrSegments) {
    return null
  }

  const normalized = Array.isArray(pathOrSegments)
    ? pathOrSegments.filter(Boolean).join('/')
    : String(pathOrSegments).replace(/^\/+|\/+$/g, '')

  if (!normalized) {
    return null
  }

  return serviceIndex.get(normalized) ?? null
}
